<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual de Uso - Script 1-alimentar_mongodb_openstreet.py</title>
    <style>
        * {
            box-sizing: border-box;
        }

        html {
            height: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e6e6e6;
            min-height: 100vh;
        }

        h1 {
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 15px;
            margin-top: 0;
            font-size: 2.2rem;
        }

        h2 {
            color: #81C784;
            margin-top: 40px;
            font-size: 1.6rem;
            border-left: 4px solid #4CAF50;
            padding-left: 15px;
        }

        h3 {
            color: #BDBDBD;
            font-size: 1.3rem;
        }

        h4 {
            color: #A1887F;
        }

        code {
            background-color: #37474F;
            color: #80CBC4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 0.9rem;
        }

        pre {
            background-color: #263238;
            color: #E0F2F1;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', Consolas, monospace;
            font-size: 0.9rem;
            border: 1px solid #37474F;
        }

        ul {
            list-style-type: disc;
            margin-left: 20px;
        }

        .warning {
            background: linear-gradient(135deg, #424242 0%, #212121 100%);
            border-left: 5px solid #FF6F00;
            padding: 15px 20px;
            margin: 25px 0;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .warning strong {
            color: #FF8A65;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background-color: #424242;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        th, td {
            border: 1px solid #616161;
            padding: 12px 15px;
            text-align: left;
        }

        th {
            background: linear-gradient(135deg, #37474F 0%, #455A64 100%);
            color: #E0F2F1;
            font-weight: 600;
            font-size: 0.95rem;
        }

        tr:nth-child(even) {
            background-color: #37474F;
        }

        tr:nth-child(odd) {
            background-color: #424242;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 15px;
                font-size: 0.9rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            h2 {
                font-size: 1.4rem;
                margin-top: 30px;
            }

            h3 {
                font-size: 1.2rem;
            }

            pre {
                font-size: 0.8rem;
                padding: 12px;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 8px 10px;
            }

            .warning {
                padding: 12px 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.6rem;
            }

            h2 {
                font-size: 1.2rem;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 6px 8px;
            }
        }

        /* Accessibility improvements */
        a {
            color: #4CAF50;
            transition: color 0.3s ease;
        }

        a:hover {
            color: #81C784;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        ::-webkit-scrollbar-thumb {
            background: #616161;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #757575;
        }
    </style>
</head>
<body>
    <h1>Manual de Uso - Script 1-alimentar_mongodb_openstreet.py</h1>

    <h2>Descripción General</h2>
    <p>El script <code>1-alimentar_mongodb_openstreet.py</code> es una herramienta diseñada para procesar imágenes desde un directorio específico y extraer metadatos relevantes, incluyendo información GPS y direcciones geocodificadas. Los datos procesados se almacenan en una base de datos MongoDB para facilitar la organización y búsqueda de imágenes.</p>

    <p>El script incorpora las siguientes funcionalidades principales:</p>
    <ul>
        <li>Escaneo recursivo de directorios en busca de archivos de imagen</li>
        <li>Extracción de metadatos básicos (dimensiones, fecha de creación, etc.)</li>
        <li>Procesamiento de coordenadas GPS desde metadatos EXIF</li>
        <li>Geocodificación inversa usando la API de OpenStreetMap (Nominatim)</li>
        <li>Almacenamiento en MongoDB usando hash SHA512 como identificador único</li>
    </ul>

    <h2>Requisitos del Sistema</h2>
    <h3>Dependencias de Python</h3>
    <p>El script requiere las siguientes bibliotecas de Python:</p>
    <ul>
        <li><code>pymongo</code></li>
        <li><code>PIL</code> (Python Imaging Library, más conocido como Pillow)</li>
        <li><code>exifread</code></li>
        <li><code>requests</code></li>
    </ul>

    <h3>Requisitos de Base de Datos</h3>
    <ul>
        <li>Instancia de MongoDB ejecutándose localmente (puerto 27017 por defecto)</li>
        <li>Acceso de escritura a una base de datos llamada <code>album_2</code></li>
        <li>Colección <code>imagenes</code> (se creará automáticamente si no existe)</li>
    </ul>

    <h3>Requisitos del Sistema Operativo</h3>
    <ul>
        <li>Sistema operativo Linux/Windows/MacOS</li>
        <li>Acceso de lectura al directorio que contiene las imágenes</li>
        <li>Conexión a internet para geocodificación (opcional)</li>
    </ul>

    <h2>Instalación y Configuración</h2>

    <h3>Instalación de Dependencias</h3>
    <p>Ejecute los siguientes comandos para instalar las bibliotecas requeridas:</p>
    <pre><code>pip install pymongo pillow exifread requests</code></pre>

    <h3>Configuración del script</h3>
    <p>Antes de ejecutar el script, es necesario modificar las siguientes constantes en el archivo:</p>

    <h4>Configuración del Directorio a Escanear</h4>
    <pre><code>DIRECTORY = '/mnt/local/datos/PROYCTO_ALBUM_SEMANTICO/IMAGENES'</code></pre>
    <p>Cambie esta ruta por el directorio que contiene las imágenes que desea procesar.</p>

    <h4>Configuración de MongoDB (Opcional)</h4>
    <pre><code>MONGO_URI = "mongodb://localhost:27017"
DB_NAME = "album_2"
COLLECTION_NAME = "imagenes"</code></pre>
    <p>Modifique estos valores según su configuración de MongoDB si es necesario.</p>

    <div class="warning">
        <strong>Advertencia:</strong> Asegúrese de que el directorio especificado existe y es accesible. El script verificará esta condición antes de iniciar el procesamiento.
    </div>

    <h2>Uso del Script</h2>

    <h3>Ejecución Básica</h3>
    <p>Para ejecutar el script, navegue al directorio donde se encuentra el archivo y ejecute:</p>
    <pre><code>python 1-alimentar_mongodb_openstreet.py</code></pre>

    <h3>Acceso al Script</h3>
    <p>El script completo está disponible en la carpeta <code>codigo/</code> del proyecto:</p>
    <p><a href="../codigo/1-alimentar_mongodb_openstreet.py" target="_blank" style="color: #4CAF50; text-decoration: none; font-weight: bold;">📄 Descargar 1-alimentar_mongodb_openstreet.py</a></p>

    <h3>Progreso y Salidas</h3>
    <p>El script proporcionará información en tiempo real durante el procesamiento:</p>
    <ul>
        <li>Archivos procesados</li>
        <li>Imágenes con información GPS encontrada</li>
        <li>Imágenes sin información GPS</li>
        <li>Errores de procesamiento</li>
    </ul>

    <h3>Alto del Procesamiento</h3>
    <p>El script puede ser detenido en cualquier momento con <code>Ctrl+C</code>. Sin embargo, los datos ya procesados permanecerán en la base de datos.</p>

    <h2>Funcionalidades Detalladas</h2>

    <h3>Procesamiento de Archivos</h3>
    <ul>
        <li><strong>Extensiones soportadas:</strong> jpg, jpeg, png, tiff, bmp</li>
        <li><strong>Escaneo recursivo:</strong> Busca imágenes en subdirectorios</li>
        <li><strong>Control de duplicados:</strong> Usa hash SHA512 para evitar procesar archivos duplicados</li>
    </ul>

    <h3>Extracción de Metadatos</h3>
    <ul>
        <li>Dimensiones de la imagen (ancho y alto)</li>
        <li>Fecha de modificación del archivo</li>
        <li>Coordenadas GPS desde metadatos EXIF</li>
        <li>Geocodificación inversa a direcciones legibles</li>
    </ul>

    <h3>Procesamiento GPS</h3>
    <p>Para imágenes con coordenadas GPS, el script:</p>
    <ol>
        <li>Extrae las coordenadas en formato DMS de los metadatos EXIF</li>
        <li>Convierte las coordenadas a formato decimal</li>
        <li>Realiza geocodificación inversa usando Nominatim de OpenStreetMap</li>
        <li>Almacena ambos las coordenadas numéricas y la dirección legible</li>
    </ol>

    <h2>Estructura de Datos en MongoDB</h2>

    <p>Cada documento en la colección <code>imagenes</code> contiene la siguiente estructura:</p>

    <h3>Campos Principales</h3>
    <table>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Descripción</th>
        </tr>
        <tr>
            <td><code>_id</code></td>
            <td>String</td>
            <td>Hash SHA512 del archivo (identificador único)</td>
        </tr>
        <tr>
            <td><code>hash_sha512</code></td>
            <td>String</td>
            <td>Mismo valor que _id para compatibilidad</td>
        </tr>
        <tr>
            <td><code>nombre_archivo</code></td>
            <td>String</td>
            <td>Nombre del archivo de imagen</td>
        </tr>
        <tr>
            <td><code>ruta_completa</code></td>
            <td>String</td>
            <td>Ruta completa al archivo</td>
        </tr>
        <tr>
            <td><code>ancho</code></td>
            <td>Integer</td>
            <td>Ancho de la imagen en píxeles</td>
        </tr>
        <tr>
            <td><code>alto</code></td>
            <td>Integer</td>
            <td>Alto de la imagen en píxeles</td>
        </tr>
    </table>

    <h3>Campos de Fecha de Creación</h3>
    <p>La fecha de creación se separa en campos individuales para facilitar las consultas:</p>
    <ul>
        <li><code>fecha_creacion_dia</code>: Día del mes (01-31)</li>
        <li><code>fecha_creacion_mes</code>: Mes (01-12)</li>
        <li><code>fecha_creacion_anio</code>: Año (YYYY)</li>
        <li><code>fecha_creacion_hora</code>: Hora (00-23)</li>
        <li><code>fecha_creacion_minuto</code>: Minuto (00-59)</li>
    </ul>

    <h3>Campos de Geocodificación</h3>
    <table>
        <tr>
            <th>Campo</th>
            <th>Tipo</th>
            <th>Descripción</th>
        </tr>
        <tr>
            <td><code>coordenadas</code></td>
            <td>Array</td>
            <td>[latitud, longitud] en formato decimal (null si no GPS)</td>
        </tr>
        <tr>
            <td><code>direccion_os</code></td>
            <td>String</td>
            <td>Dirección geocodificada (null si falla la geocodificación)</td>
        </tr>
    </table>

    <h3>Campos de Procesamiento</h3>
    <p>La fecha de procesamiento se actualiza cada vez que se ejecuta el script:</p>
    <ul>
        <li><code>fecha_procesamiento_dia</code>: Día del procesamiento</li>
        <li><code>fecha_procesamiento_mes</code>: Mes del procesamiento</li>
        <li><code>fecha_procesamiento_anio</code>: Año del procesamiento</li>
        <li><code>fecha_procesamiento_hora</code>: Hora del procesamiento</li>
        <li><code>fecha_procesamiento_minuto</code>: Minuto del procesamiento</li>
    </ul>

    <h2>Solución de Problemas</h2>

    <h3>Errores Comunes</h3>

    <h4>Error: "El directorio no existe"</h4>
    <p><strong>Causa:</strong> La ruta especificada en <code>DIRECTORY</code> no es válida.</p>
    <p><strong>Solución:</strong> Verifique la ruta del directorio y asegúrese de que existe y es accesible.</p>

    <h4>Error: "ConnectionError" o "ServerSelectionTimeoutError"</h4>
    <p><strong>Causa:</strong> No se puede conectar a MongoDB.</p>
    <p><strong>Solución:</strong> Verifique que MongoDB esté ejecutándose y que la URI en <code>MONGO_URI</code> sea correcta.</p>

    <h4>Error de geocodificación</h4>
    <p><strong>Causa:</strong> Problemas de conexión a internet o límites de la API.</p>
    <p><strong>Solución:</strong> El script manejará automáticamente este error, dejando el campo <code>direccion_os</code> como <code>null</code>.</p>

    <h4>Imágenes sin GPS</h4>
    <p><strong>Causa:</strong> La imagen no contiene metadatos GPS en sus metadatos EXIF.</p>
    <p><strong>Solución:</strong> Esto es normal para muchas imágenes tomadas con dispositivos móviles más antiguos o sin GPS habilitado.</p>

    <h3>Optimizaciones de Rendimiento</h3>
    <ul>
        <li><strong>Procesamiento masivo:</strong> Para grandes volúmenes de imágenes, considere dividir el procesamiento en lotes más pequeños</li>
        <li><strong>Control de duplicados:</strong> El script automáticamente evita reprocesar archivos idénticos gracias al hash SHA512</li>
        <li><strong>Geocodificación:</strong> El script respeta los límites de la API Nominatim (1 solicitud por segundo)</li>
    </ul>

    <h2>Consultas de Ejemplo en MongoDB</h2>

    <h3>Buscar imágenes por fecha de creación</h3>
    <pre><code>db.imagenes.find({
    "fecha_creacion_anio": "2023",
    "fecha_creacion_mes": "07"
})</code></pre>

    <h3>Buscar imágenes con coordenadas GPS</h3>
    <pre><code>db.imagenes.find({
    "coordenadas": { $ne: null }
})</code></pre>

    <h3>Buscar imágenes por dirección aproximada</h3>
    <pre><code>db.imagenes.find({
    "direccion_os": /Madrid/
})</code></pre>

    <h3>Contar total de imágenes procesadas</h3>
    <pre><code>db.imagenes.countDocuments()</code></pre>

    <h2>Información de Versión y Soporte</h2>
    <p>Este script fue desarrollado para el proyecto Album Semántico y está optimizado para el procesamiento de imágenes con metadatos GPS.</p>

    <p>Para soporte técnico o consultas adicionales, revise la documentación del proyecto o contacte al equipo de desarrollo.</p>

    <hr>
    <p><small>Manual generado automáticamente - Última actualización: 31 de agosto de 2025</small></p>

    <!-- Footer -->
    <footer style="background: linear-gradient(135deg, #212121 0%, #424242 100%); padding: 25px; margin-top: 50px; text-align: center; border-top: 3px solid #4CAF50; border-radius: 8px 8px 0 0;">
        <p style="margin: 0; color: #e6e6e6;">
            <a href="pildoras.html" style="color: #4CAF50; text-decoration: none; font-weight: bold; font-size: 1.1rem; transition: all 0.3s ease;">
                ← Volver a Píldoras
            </a>
        </p>
    </footer>
</body>
</html>
